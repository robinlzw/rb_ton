# 要开发 TON 应用程序的人需要关注的元素

## 1.Func and Fift
Func 是一种为编写智能合约而开发的类 C 语言。虽然它可能看起来有点令人困惑，但一旦你习惯了它，这种语言就很有意义，而且事实上，看起来相当全面。 
Fift 是一种基于堆栈的语言，用作与 TON 交互的语言。它包含 TON“理解”的 TVM 和 Fift 汇编指令。

这两种语言都相对较新，这会导致多种潜在错误，尤其是来自新手开发人员的错误。这是 TON 的清单。


## 2.Name collisions
Func 变量和函数可以包含几乎所有合法字符。也就是说，包括加号（var++）、波浪线（~bits）、破折号（foo-bar+baz）以及逗号在内的字符都是有效的变量名和函数名。


## 3.Check the throw values
每次 TVM 执行正常停止时，都会以退出代码 0 或 1 停止。尽管这是自动完成的，但如果通过 throw(0) 或 throw 直接抛出退出代码 0 和 1，TVM 执行可能会以意外方式直接中断。


## 4.Type and store values
Func 是一种严格类型化的语言，其数据结构中存储的内容完全符合它们应该存储的内容。
了解代码的作用以及它可能返回的内容至关重要。
请记住，编译器只关心代码本身，并且只在其初始状态下关心。经过某些操作后，一些变量的存储值可能会发生变化。

读取意外变量的值以及在不应该具有这些方法的数据类型上调用方法（或者它们的返回值没有被正确存储）都是错误，并且不会被跳过作为“警告”或“通知”，而是会导致无法到达的代码。
请注意，存储一个意外的值可能是可以的，但是读取它可能会引起问题。例如，对于整型变量，可能会抛出错误代码 5（整数超出预期范围）。


## 5.您应该对 Fift 和 TVM 汇编指令有所了解
Func 函数经常使用直接的 Fift "asm" 指令构建。审计员必须知道它们的作用，并仔细观察堆栈中的内容。


## 6.与其他区块链不同，TON 不包含回退消息，只有退出代码
在开始编写您的 TON 智能合约之前，仔细考虑退出代码的路线图（并将其记录下来）是有帮助的。


## 7.消息有模式
（由一个数字表示的一组标志），其中之一可能用作自毁，另一个用于将余额上的所有剩余硬币发送出去。
对于 TON 区块链审计员来说，检查消息模式是至关重要的。


## 8.TON 完全实现了 actor 模型
这意味着合约的代码可以被更改。它可以通过使用 SETCODE TVM 指令永久更改，或者在运行时更改，将 TVM 代码注册表设置为新的单元值，直到执行结束。


## 9.TON 区块链有几个交易阶段：计算阶段、动作阶段以及反弹阶段等
计算阶段执行智能合约的代码，然后才执行动作（发送消息、代码修改、更改库等）。
所以，与基于以太坊的区块链不同，如果您期望发送的消息失败，您不会看到计算阶段的退出代码，因为它不是在计算阶段执行的，而是在稍后的动作阶段执行的。


## 10.具有 method_id 标识符的 Func 函数具有方法 ID
它们可以显式设置 "method_id(5)"，或者由 func 编译器隐式设置。在这种情况下，它们可以在 .fift 汇编文件中的方法声明中找到。
其中两个是预定义的：一个用于在区块链内部接收消息（0），通常命名为 recv_internal，另一个用于从外部接收消息（-1），recv_external。


## 11.TON 加密地址可能没有任何硬币或代码
TON 区块链中智能合约的地址是确定性的，并且可以预计算。
与地址关联的 Ton 账户甚至可能不包含任何代码，这意味着它们未初始化（如果未部署）或者在发送了具有特殊标志的消息后被冻结，同时如果消息具有特殊标志，它们可能没有更多的存储或 TON 硬币。


## 12.TON 地址可能有三种表示形式
完整表示可以是“原始”的（workchain:address）或“用户友好”的。后者是用户最常遇到的形式。它包含一个标签字节，指示地址是否可以反弹，以及一个工作链 id 字节。这些信息应该被记录下来。


## 13.跟踪代码执行中的缺陷
与 Solidity 不同，您可以设置方法的可见性，在 Func 的情况下，可见性以更复杂的方式受到限制，要么显示错误，要么通过 "if" 语句。


## 14.在发送反弹消息之前注意 gas
如果智能合约发送用户提供价值的反弹消息，请确保相应的 gas 费用从返回的金额中减去，以免被耗尽。


## 15.监控回调及其故障
TON 区块链是异步的。这意味着消息不必连续到达。例如，当一个动作的失败通知到达时，应该正确处理。


## 16.检查接收内部消息时是否发送了反弹标志
您可能会收到反弹消息（错误通知），应该处理这些消息。


## 17.为外部消息编写重放保护：
有两种自定义解决方案适用于钱包（智能合约，存储用户的钱）：基于 seqno（检查计数器，不要两次处理消息）和高负载（存储进程标识符及其过期时间）。

对于没有准备的审计员或开发者来说，TON 可能看起来像是一个复杂的链，但是知道期待什么可以给您带来明显的优势。
上述 17 个技巧对于部署到 TON 的任何智能合约都可以产生巨大的影响。
